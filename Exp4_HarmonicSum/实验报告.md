# 实验四：调和级数求和顺序与舍入误差实验报告

## 1. 实验目的
1. 实现并比较两种调和级数求和方法
2. 量化分析不同求和顺序导致的计算结果差异
3. 理解浮点数舍入误差的累积效应
4. 探究求和顺序对数值计算精度的影响

## 2. 实验原理
### 2.1 调和级数部分和
调和级数的前N项和定义为：

$$ S_N = \sum_{n=1}^{N} \frac{1}{n} $$

### 2.2 两种求和方法
1. 从小到大求和（ $S^{(up)}$）：

$$ S^{(up)} = \sum_{n=1}^{N}\frac{1}{n} = \frac{1}{1} + \frac{1}{2} + \frac{1}{3} + \cdots + \frac{1}{N} $$

2. 从大到小求和（ $S^{(down)}$）：

$$ S^{(down)} = \sum_{n=N}^{1}\frac{1}{n} = \frac{1}{N} + \frac{1}{N-1} + \cdots + \frac{1}{2} + \frac{1}{1} $$

### 2.3 相对差异计算
两种方法的相对差异定义为：

$$ \delta = \frac{|S^{(up)} - S^{(down)}|}{|(S^{(up)} + S^{(down)}) / 2|} $$

## 3. 实验方法
### 3.1 代码实现
- 实现 `sum_up(N)` 函数，从小到大计算调和级数和
- 实现 `sum_down(N)` 函数，从大到小计算调和级数和

### 3.2 数据收集
对不同的N值进行计算：
1. N值选取：使用 `np.logspace(1, 4, 50)` 在对数尺度上均匀取点
2. 计算并记录相对差异

## 4. 实验结果
### 4.1 数据记录

| N | $S^{(up)}$ | $S^{(down)}$ | 相对差异 δ |
|---|------------|--------------|------------|
| 10 |     2.9289682539682538      |    2.9289682539682538          |    0.0        |
| 100 |    5.187377517639621      |    5.1873775176396215          |    1.712191597160384e-16        |
| 1000 |   7.485470860550343      |    7.485470860550341          |    3.559609420354454e-16        |
| 10000 |  9.787606036044348      |    9.787606036044386          |    3.811299054133299e-15        |

### 4.2 误差分析图
![Figure_1](https://github.com/user-attachments/assets/a9c8b369-02e4-4d0c-b1a6-c84d105b8332)


## 5. 分析与讨论
### 5.1 结果分析
1. 相对差异随N的变化趋势：
   随着N变大，相对差异也在增大

2. 舍入误差累积效应：
   浮点数采用IEEE 754标准表示，其精度由有效位数（双精度为52位尾数）决定。当两个数相加时，若量级差异过大，较小数的低位会被舍入。sum_down的求和顺序（从小项到大项）保证了每次加法时，当前总和与新增项的量级差异较小，从而更充分地利用浮点数的有效位数，减少误差累积。

### 5.2 误差来源分析
1. 浮点数表示精度限制
2. 加法运算中的舍入
3. 求和顺序的影响

## 6. 结论
1、求和顺序显著影响精度：从大到小求和（sum_down）通过优先累加小项，减少了舍入误差的累积，计算结果更精确。

2、误差与N正相关：N越大，两种方法的相对差异δ越大，表明舍入误差的累积效应随计算量增加而增强。

3、浮点数特性是关键：IEEE 754浮点数的有限精度和加法规则是误差的核心来源，需在数值计算中特别注意。

## 7. 思考题
1. 为什么从大到小求和通常能获得更好的精度？
从大到小求和时，小项在总和较小时被优先累加，避免了后续大项对它们的“淹没”效应。浮点数加法的舍入误差在量级相近时更小，因此该顺序能保留更多有效位数，提高精度。
1. 在实际应用中，如何选择合适的求和策略来减小舍入误差？
排序累加：将数值按绝对值从小到大排序后累加。
分组求和：将大数和小数分组分别累加，再合并结果。
使用补偿算法：如Kahan求和法，动态跟踪并补偿舍入误差。
2. 除了改变求和顺序，还有什么方法可以提高数值计算的精度？
高精度数据类型：使用四精度（float128）或任意精度库（如mpmath）。
算法优化：如Kahan求和、成对相加（Pairwise Summation）或分治策略。
公式变形：利用数学恒等式减少计算次数（如调和级数可结合渐近展开式优化）。

## 附录：关键代码
```python
# 在此粘贴关键代码实现
```

